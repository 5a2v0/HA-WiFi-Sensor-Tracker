######  PORZIONI DI CODICE DA METTERE NELLA PR, iniziando dalla dichiarazione iniziale delle variabili che include la nostra nuova


        latest_non_gps_home = latest_non_gps_zone = latest_not_home = latest_gps = latest = coordinates = None


##### poi il primo blocchetto con elif aggiunto:

            if state.attributes.get(ATTR_SOURCE_TYPE) == SourceType.GPS:
                latest_gps = _get_latest(latest_gps, state)
            elif state.state == STATE_HOME:
                latest_non_gps_home = _get_latest(latest_non_gps_home, state)
            elif state.state not in (STATE_HOME, STATE_NOT_HOME):
                 latest_non_gps_zone = _get_latest(latest_non_gps_zone, state)
            else:
                latest_not_home = _get_latest(latest_not_home, state)


##### poi il secondo blocco con elif aggiunto:


        if latest_non_gps_home:
            latest = latest_non_gps_home
            if (
                latest_non_gps_home.attributes.get(ATTR_LATITUDE) is None
                and latest_non_gps_home.attributes.get(ATTR_LONGITUDE) is None
                and (home_zone := self.hass.states.get(ENTITY_ID_HOME))
            ):
                coordinates = home_zone
            else:
                coordinates = latest_non_gps_home
        elif latest_non_gps_zone:
            latest = latest_non_gps_zone
            coordinates = latest_non_gps_zone
        elif latest_gps:
            latest = latest_gps
            coordinates = latest_gps
        else:
            latest = latest_not_home
            coordinates = latest_not_home


##### POSSIBILE PATCH ANCHE PER ELIMINARE LA GPS PRECISION DAI TRACKER NON GPS


@callback
def _parse_source_state(self, state: State, coordinates: State) -> None:
    """Parse source state and set person attributes."""

    self._attr_state = state.state
    self._source = state.entity_id
    self._latitude = coordinates.attributes.get(ATTR_LATITUDE)
    self._longitude = coordinates.attributes.get(ATTR_LONGITUDE)
    if state.attributes.get(ATTR_SOURCE_TYPE) == SourceType.GPS:
        self._gps_accuracy = state.attributes.get(ATTR_GPS_ACCURACY)
    else:
        self._gps_accuracy = None
